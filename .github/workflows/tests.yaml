name: Run tests
on: push

jobs:
  build_deps_and_run_tests:
    name: Build dependecies and run tests
    runs-on: ubuntu-latest
    steps:

    - name: Check out repo ğŸ™ğŸ˜¸
      uses: actions/checkout@master
      with:
        submodules: recursive

    - name: Build deps ğŸ› ï¸
      run: sudo third_party/install.sh

    - name: Install LLVM and clang ğŸ› ï¸
      run: sudo apt -y install llvm clang

    - name: Set up Python ğŸ
      uses: actions/setup-python@v5
      with:
        python-version: "3.12"
        cache: 'pip'
    - run: pip install -r requirements-dev.txt

    # - name: Install mpi4py
    #   run: python -m pip install mpi4py halo --user

    - name: Build python package ğŸ“¦
      run: pip install . && ./setup.py build_ext -i

    # - name: Run end2end.py
    #   run: python examples/end2end.py

    - name: Run unittests
      run: python -m unittest
